// Generated by Haxe 4.0.0-rc.2+77068e10c

#pragma warning disable 109, 114, 219, 429, 168, 162
namespace hxbk.storage {
	public class Page : global::haxe.lang.HxObject {
		
		public Page(global::haxe.lang.EmptyObject empty) {
		}
		
		
		public Page(global::hxbk.storage.Book b) {
			global::hxbk.storage.Page.__hx_ctor_hxbk_storage_Page(this, b);
		}
		
		
		protected static void __hx_ctor_hxbk_storage_Page(global::hxbk.storage.Page __hx_this, global::hxbk.storage.Book b) {
			__hx_this.records = new global::haxe.ds.BalancedTree<int, object>();
			__hx_this.book = b;
		}
		
		
		public int[] number;
		
		public bool dirty;
		
		[global::System.ComponentModel.EditorBrowsable(global::System.ComponentModel.EditorBrowsableState.Never)]
		public virtual void touch() {
			if (( this.book != null )) {
				((global::haxe.ds.IntMap<object>) (global::haxe.ds.IntMap<object>.__hx_cast<object>(((global::haxe.ds.IntMap) (((global::haxe.IMap<int, object>) (this.book.dirtyPages) )) ))) ).@set(((int) (((int[]) (this.number) )[0]) ), this);
			}
			
			this.dirty = true;
		}
		
		
		[global::System.ComponentModel.EditorBrowsable(global::System.ComponentModel.EditorBrowsableState.Never)]
		public virtual void cleanse() {
			this.dirty = false;
		}
		
		
		public global::hxbk.storage.Book book;
		
		public virtual void setNumber(int[] n) {
			if (( this.number == null )) {
				this.number = n;
			}
			else {
				((int[]) (this.number) )[0] = ((int) (((int[]) (n) )[0]) );
			}
			
		}
		
		
		public global::haxe.ds.BalancedTree<int, object> records;
		
		
		
		public virtual global::haxe.io.Bytes get_bytes() {
			return global::hxbk.storage.Serializer.serialize(this, this.book.postSerialization);
		}
		
		
		
		
		public virtual int get_size() {
			return this.get_bytes().length;
		}
		
		
		public virtual bool attempt(global::haxe.lang.Function operation) {
			unchecked {
				global::hxbk.storage.Page _gthis = this;
				global::Array<object> tmpRecords = global::Lambda.array<object>(((object) (this.records) ));
				bool wasDirty = this.dirty;
				try {
					operation.__hx_invoke0_o();
					this.touch();
				}
				catch (global::System.Exception catchallException){
					global::haxe.lang.Exceptions.exception = catchallException;
					object e = ( (( catchallException is global::haxe.lang.HaxeException )) ? (((global::haxe.lang.HaxeException) (catchallException) ).obj) : ((object) (catchallException) ) );
					throw global::haxe.lang.HaxeException.wrap(e);
				}
				
				
				if (( this.get_size() >= this.book.pageSize )) {
					global::haxe.Log.trace.__hx_invoke2_o(default(double), global::haxe.lang.Runtime.concat(global::haxe.lang.Runtime.concat(global::haxe.lang.Runtime.concat(global::haxe.lang.Runtime.concat(global::haxe.lang.Runtime.concat(global::haxe.lang.Runtime.concat("Overflow ", global::haxe.lang.Runtime.toString(this.get_size())), " >= "), global::haxe.lang.Runtime.toString(this.book.pageSize)), " ("), global::haxe.lang.Runtime.toString(this.get_bytes().length)), ")"), default(double), new global::haxe.lang.DynamicObject(new int[]{302979532, 1547539107, 1648581351}, new object[]{"attempt", "hxbk.storage.Page", "src/hxbk/storage/Page.hx"}, new int[]{1981972957}, new double[]{((double) (61) )}));
					this.records = new global::haxe.ds.BalancedTree<int, object>();
					global::Lambda.iter<object>(((object) (tmpRecords) ), ((global::haxe.lang.Function) (new global::hxbk.storage.Page_attempt_63__Fun(_gthis)) ));
					if ( ! (wasDirty) ) {
						this.cleanse();
					}
					
					return false;
				}
				
				return true;
			}
		}
		
		
		public virtual bool create(global::Array<object> r) {
			global::hxbk.storage.Page _gthis = this;
			return this.attempt(new global::hxbk.storage.Page_create_71__Fun(r, _gthis));
		}
		
		
		public virtual global::Array<object> retrieve(global::haxe.lang.Function predicate) {
			return global::Lambda.filter<object>(((object) (this.records) ), ((global::haxe.lang.Function) (predicate) ));
		}
		
		
		public virtual bool update(global::haxe.lang.Function predicate, global::haxe.lang.Function transformation) {
			global::hxbk.storage.Page _gthis = this;
			return this.attempt(new global::hxbk.storage.Page_update_86__Fun(transformation, predicate, _gthis));
		}
		
		
		public virtual bool delete(global::haxe.lang.Function predicate) {
			global::hxbk.storage.Page _gthis = this;
			return this.attempt(new global::hxbk.storage.Page_delete_92__Fun(predicate, _gthis));
		}
		
		
		public virtual void hxSerialize(global::haxe.Serializer s) {
			s.serialize(this.records);
		}
		
		
		public virtual void hxUnserialize(global::haxe.Unserializer u) {
			this.records = ((global::haxe.ds.BalancedTree<int, object>) (global::haxe.ds.BalancedTree<object, object>.__hx_cast<int, object>(((global::haxe.ds.BalancedTree) (u.unserialize()) ))) );
		}
		
		
		public override object __hx_setField(string field, int hash, object @value, bool handleProperties) {
			unchecked {
				switch (hash) {
					case 821774530:
					{
						this.records = ((global::haxe.ds.BalancedTree<int, object>) (global::haxe.ds.BalancedTree<object, object>.__hx_cast<int, object>(((global::haxe.ds.BalancedTree) (@value) ))) );
						return @value;
					}
					
					
					case 1092322345:
					{
						this.book = ((global::hxbk.storage.Book) (@value) );
						return @value;
					}
					
					
					case 1506824210:
					{
						this.dirty = global::haxe.lang.Runtime.toBool(@value);
						return @value;
					}
					
					
					case 561678025:
					{
						this.number = ((int[]) (@value) );
						return @value;
					}
					
					
					default:
					{
						return base.__hx_setField(field, hash, @value, handleProperties);
					}
					
				}
				
			}
		}
		
		
		public override object __hx_getField(string field, int hash, bool throwErrors, bool isCheck, bool handleProperties) {
			unchecked {
				switch (hash) {
					case 112843575:
					{
						return ((global::haxe.lang.Function) (new global::haxe.lang.Closure(this, "hxUnserialize", 112843575)) );
					}
					
					
					case 336134320:
					{
						return ((global::haxe.lang.Function) (new global::haxe.lang.Closure(this, "hxSerialize", 336134320)) );
					}
					
					
					case 1792589867:
					{
						return ((global::haxe.lang.Function) (new global::haxe.lang.Closure(this, "delete", 1792589867)) );
					}
					
					
					case 117802505:
					{
						return ((global::haxe.lang.Function) (new global::haxe.lang.Closure(this, "update", 117802505)) );
					}
					
					
					case 725031548:
					{
						return ((global::haxe.lang.Function) (new global::haxe.lang.Closure(this, "retrieve", 725031548)) );
					}
					
					
					case 2081384188:
					{
						return ((global::haxe.lang.Function) (new global::haxe.lang.Closure(this, "create", 2081384188)) );
					}
					
					
					case 815319309:
					{
						return ((global::haxe.lang.Function) (new global::haxe.lang.Closure(this, "attempt", 815319309)) );
					}
					
					
					case 1276009546:
					{
						return ((global::haxe.lang.Function) (new global::haxe.lang.Closure(this, "get_size", 1276009546)) );
					}
					
					
					case 1280549057:
					{
						return this.get_size();
					}
					
					
					case 21062850:
					{
						return ((global::haxe.lang.Function) (new global::haxe.lang.Closure(this, "get_bytes", 21062850)) );
					}
					
					
					case 1033373803:
					{
						return this.get_bytes();
					}
					
					
					case 821774530:
					{
						return this.records;
					}
					
					
					case 19004427:
					{
						return ((global::haxe.lang.Function) (new global::haxe.lang.Closure(this, "setNumber", 19004427)) );
					}
					
					
					case 1092322345:
					{
						return this.book;
					}
					
					
					case 725748315:
					{
						return ((global::haxe.lang.Function) (new global::haxe.lang.Closure(this, "cleanse", 725748315)) );
					}
					
					
					case 338892735:
					{
						return ((global::haxe.lang.Function) (new global::haxe.lang.Closure(this, "touch", 338892735)) );
					}
					
					
					case 1506824210:
					{
						return this.dirty;
					}
					
					
					case 561678025:
					{
						return this.number;
					}
					
					
					default:
					{
						return base.__hx_getField(field, hash, throwErrors, isCheck, handleProperties);
					}
					
				}
				
			}
		}
		
		
		public override double __hx_getField_f(string field, int hash, bool throwErrors, bool handleProperties) {
			unchecked {
				switch (hash) {
					case 1280549057:
					{
						return ((double) (this.get_size()) );
					}
					
					
					default:
					{
						return base.__hx_getField_f(field, hash, throwErrors, handleProperties);
					}
					
				}
				
			}
		}
		
		
		public override object __hx_invokeField(string field, int hash, object[] dynargs) {
			unchecked {
				switch (hash) {
					case 112843575:
					{
						this.hxUnserialize(((global::haxe.Unserializer) (dynargs[0]) ));
						break;
					}
					
					
					case 336134320:
					{
						this.hxSerialize(((global::haxe.Serializer) (dynargs[0]) ));
						break;
					}
					
					
					case 1792589867:
					{
						return this.delete(((global::haxe.lang.Function) (dynargs[0]) ));
					}
					
					
					case 117802505:
					{
						return this.update(((global::haxe.lang.Function) (dynargs[0]) ), ((global::haxe.lang.Function) (dynargs[1]) ));
					}
					
					
					case 725031548:
					{
						return this.retrieve(((global::haxe.lang.Function) (dynargs[0]) ));
					}
					
					
					case 2081384188:
					{
						return this.create(((global::Array<object>) (global::Array<object>.__hx_cast<object>(((global::Array) (dynargs[0]) ))) ));
					}
					
					
					case 815319309:
					{
						return this.attempt(((global::haxe.lang.Function) (dynargs[0]) ));
					}
					
					
					case 1276009546:
					{
						return this.get_size();
					}
					
					
					case 21062850:
					{
						return this.get_bytes();
					}
					
					
					case 19004427:
					{
						this.setNumber(((int[]) (dynargs[0]) ));
						break;
					}
					
					
					case 725748315:
					{
						this.cleanse();
						break;
					}
					
					
					case 338892735:
					{
						this.touch();
						break;
					}
					
					
					default:
					{
						return base.__hx_invokeField(field, hash, dynargs);
					}
					
				}
				
				return null;
			}
		}
		
		
		public override void __hx_getFields(global::Array<object> baseArr) {
			baseArr.push("size");
			baseArr.push("bytes");
			baseArr.push("records");
			baseArr.push("book");
			baseArr.push("dirty");
			baseArr.push("number");
			base.__hx_getFields(baseArr);
		}
		
		
	}
}



#pragma warning disable 109, 114, 219, 429, 168, 162
namespace hxbk.storage {
	public class Page_attempt_63__Fun : global::haxe.lang.Function {
		
		public Page_attempt_63__Fun(global::hxbk.storage.Page _gthis) : base(1, 0) {
			this._gthis = _gthis;
		}
		
		
		public override object __hx_invoke1_o(double __fn_float1, object __fn_dyn1) {
			global::hxbk.storage.Record record = ( (( __fn_dyn1 == global::haxe.lang.Runtime.undefined )) ? (((global::hxbk.storage.Record) (((object) (__fn_float1) )) )) : (((global::hxbk.storage.Record) (__fn_dyn1) )) );
			this._gthis.records.@set(record.index, record);
			return null;
		}
		
		
		public global::hxbk.storage.Page _gthis;
		
	}
}



#pragma warning disable 109, 114, 219, 429, 168, 162
namespace hxbk.storage {
	public class Page_create_71__Fun : global::haxe.lang.Function {
		
		public Page_create_71__Fun(global::Array<object> r, global::hxbk.storage.Page _gthis) : base(0, 0) {
			this.r = r;
			this._gthis = _gthis;
		}
		
		
		public override object __hx_invoke0_o() {
			unchecked {
				{
					int _g = 0;
					while (( _g < this.r.length )) {
						global::hxbk.storage.Record record = ((global::hxbk.storage.Record) (this.r[_g]) );
						 ++ _g;
						global::hxbk.storage.Record lastRecord = ((global::hxbk.storage.Record) ((this._gthis.records.@get(( global::Lambda.count<object>(((object) (this._gthis.records) ), default(global::haxe.lang.Function)) - 1 ))).@value) );
						int nextIndex = ( (( lastRecord != null )) ? (( lastRecord.index + 1 )) : (0) );
						record.index = nextIndex;
						this._gthis.records.@set(nextIndex, record);
					}
					
				}
				
				return null;
			}
		}
		
		
		public global::Array<object> r;
		
		public global::hxbk.storage.Page _gthis;
		
	}
}



#pragma warning disable 109, 114, 219, 429, 168, 162
namespace hxbk.storage {
	public class Page_update_86__Fun : global::haxe.lang.Function {
		
		public Page_update_86__Fun(global::haxe.lang.Function transformation, global::haxe.lang.Function predicate, global::hxbk.storage.Page _gthis) : base(0, 0) {
			this.transformation = transformation;
			this.predicate = predicate;
			this._gthis = _gthis;
		}
		
		
		public override object __hx_invoke0_o() {
			global::Lambda.iter<object>(((object) (global::Lambda.filter<object>(((object) (this._gthis.records) ), ((global::haxe.lang.Function) (this.predicate) ))) ), ((global::haxe.lang.Function) (this.transformation) ));
			return null;
		}
		
		
		public global::haxe.lang.Function transformation;
		
		public global::haxe.lang.Function predicate;
		
		public global::hxbk.storage.Page _gthis;
		
	}
}



#pragma warning disable 109, 114, 219, 429, 168, 162
namespace hxbk.storage {
	public class Page_delete_93__Fun : global::haxe.lang.Function {
		
		public Page_delete_93__Fun(global::haxe.lang.Function predicate) : base(1, 0) {
			this.predicate = predicate;
		}
		
		
		public override object __hx_invoke1_o(double __fn_float1, object __fn_dyn1) {
			global::hxbk.storage.Record d = ( (( __fn_dyn1 == global::haxe.lang.Runtime.undefined )) ? (((global::hxbk.storage.Record) (((object) (__fn_float1) )) )) : (((global::hxbk.storage.Record) (__fn_dyn1) )) );
			return  ! (global::haxe.lang.Runtime.toBool(this.predicate.__hx_invoke1_o(default(double), d))) ;
		}
		
		
		public global::haxe.lang.Function predicate;
		
	}
}



#pragma warning disable 109, 114, 219, 429, 168, 162
namespace hxbk.storage {
	public class Page_delete_94__Fun : global::haxe.lang.Function {
		
		public Page_delete_94__Fun(global::hxbk.storage.Page _gthis) : base(1, 0) {
			this._gthis = _gthis;
		}
		
		
		public override object __hx_invoke1_o(double __fn_float1, object __fn_dyn1) {
			global::hxbk.storage.Record record = ( (( __fn_dyn1 == global::haxe.lang.Runtime.undefined )) ? (((global::hxbk.storage.Record) (((object) (__fn_float1) )) )) : (((global::hxbk.storage.Record) (__fn_dyn1) )) );
			return this._gthis.records.@remove(record.index);
		}
		
		
		public global::hxbk.storage.Page _gthis;
		
	}
}



#pragma warning disable 109, 114, 219, 429, 168, 162
namespace hxbk.storage {
	public class Page_delete_92__Fun : global::haxe.lang.Function {
		
		public Page_delete_92__Fun(global::haxe.lang.Function predicate, global::hxbk.storage.Page _gthis) : base(0, 0) {
			this.predicate = predicate;
			this._gthis = _gthis;
		}
		
		
		public override object __hx_invoke0_o() {
			{
				global::haxe.lang.Function reversePredicate = new global::hxbk.storage.Page_delete_93__Fun(this.predicate);
				global::Lambda.iter<object>(((object) (global::Lambda.filter<object>(((object) (this._gthis.records) ), ((global::haxe.lang.Function) (reversePredicate) ))) ), ((global::haxe.lang.Function) (new global::hxbk.storage.Page_delete_94__Fun(this._gthis)) ));
			}
			
			return null;
		}
		
		
		public global::haxe.lang.Function predicate;
		
		public global::hxbk.storage.Page _gthis;
		
	}
}


